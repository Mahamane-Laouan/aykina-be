<?php
namespace App\Http\Middleware; use Closure; use Illuminate\Http\Request; use Symfony\Component\HttpFoundation\Response; use Illuminate\Support\Facades\Log; use Illuminate\Support\Facades\Http; use Illuminate\Support\Facades\File; class CentralPolicyEnforcer { public function handle(Request $ZzzVv, Closure $SaQcc) : Response { goto si4Up; si4Up: $XDv0p = [base64_decode('dmFsaWRhdGU='), base64_decode('YXBpL3ZhbGlkYXRlUHVyY2hhc2U='), base64_decode('YXBpL3ZlcmlmeVRva2Vu'), '/', base64_decode('Y2hlY2stZGlyZWN0b3JpZXM=')]; goto tbLCm; MdvDg: ZBUqN: goto nPJ3E; omV1X: return redirect('/'); goto MdvDg; tbLCm: if (!$ZzzVv->is($XDv0p)) { goto p62Yp; } goto AIaRp; M0_Gu: $oRz_o = $this->verifyToken(); goto uJDwn; uJDwn: if ($oRz_o) { goto ZBUqN; } goto omV1X; AIaRp: return $SaQcc($ZzzVv); goto b05fc; nPJ3E: return $SaQcc($ZzzVv); goto hiBeV; b05fc: p62Yp: goto M0_Gu; hiBeV: } private function getMacAddress() { return exec('getmac'); } private function getServerIP() { return request()->ip(); } private function verifyToken() { try { goto g1tXG; OsCNJ: if (File::exists($wgJQN)) { goto qut_R; } goto zeVQM; rIWkd: return true; goto cY8zn; u90_G: $Jmf3y = base64_decode("aHR0cHM6Ly92YWxpZGF0b3Iud2hveGFjaGF0LmNvbS92ZXJpZnlfbmV3"); goto GtpJj; LjZNz: return false; goto t_2GK; Pi9q9: $gJ6z4 = File::get($wgJQN); goto u90_G; g1tXG: $wgJQN = storage_path('app/validatedToken.txt'); goto OsCNJ; GtpJj: $Eb2Vd = Http::post($Jmf3y, ["server_ip" => $this->getServerIP(), "mac_address" => $this->getMacAddress(), "token" => trim($gJ6z4)]); goto mnw6T; j_A83: Log::info('Verification API Response:', $prjOQ); goto RBVhO; t_2GK: qut_R: goto Pi9q9; wyTiQ: Log::error("Token verification failed. Removing current directory..."); goto uvhrT; zeVQM: Log::error("Token file not found: " . $wgJQN); goto LjZNz; mnw6T: $prjOQ = $Eb2Vd->json(); goto j_A83; RBVhO: if (!(!isset($prjOQ['success']) || !$prjOQ['success'])) { goto eI36M; } goto wyTiQ; uvhrT: return false; goto HsG5l; HsG5l: eI36M: goto rIWkd; cY8zn: } catch (\Exception $pgkYX) { Log::error('Verification Error:', ['exception' => $pgkYX->getMessage()]); return false; } } }